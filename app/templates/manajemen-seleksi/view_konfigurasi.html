<!DOCTYPE html>
<html class="transition duration-300 ease-in-out" lang="{{ current_lang }}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    <title>
      {{ 'Data Konfigurasi Seleksi | SPK Pramuka' if current_lang == 'id' else
      'Selection Configuration Data | Scout DSS' }}
    </title>

    <!-- Tailwind CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/output.css') }}"
    />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
    />

    <!-- Alpine.js -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <!-- Script Sidebar -->
    {% include "script_sidebar.html" %}

    <!-- Script Theme -->
    {% include 'script_theme.html' %}
  </head>
  <body
    x-data="viewConfigData()"
    :class="{ 'dark': $store.theme?.isDark }"
    x-bind:class="{
        'bg-background-dark text-white': $store.theme?.isDark,
        'bg-gray-100 text-black': !$store.theme?.isDark
      }"
    class="transition duration-300 ease-in-out font-sans scroll-smooth {{ 'bg-background-dark text-white' if current_theme == 'dark' else 'bg-gray-100 text-black' }}"
  >
    <div
      class="flex h-screen {{ 'bg-gray-800' if current_theme == 'dark' else 'bg-gray-300' }}"
    >
      <!-- Sidebar -->
      {% include 'sidebar.html' %}

      <!-- Main content -->
      <div class="flex flex-col flex-1 overflow-hidden h-full">
        <!-- Top Navbar -->
        {% include 'header.html' %}

        <!-- Page Content -->
        <main
          class="flex-1 overflow-y-auto pt-28 h-full transition-all duration-300"
          :class="Alpine.store('sidebar').open ? 'ml-[15%]' : 'ml-[1%]'"
        >
          <section
            class="flex items-center justify-center wow animate__animated animate__fadeInUp animate__delay-0.5s {{ 'bg-gray-800' if current_theme == 'dark' else 'bg-gray-300' }}"
          >
            <!-- Notification Box -->
            {% include 'notification_box.html' %}

            <!-- Content -->
            <div class="container mx-auto p-6">
              <div class="flex justify-between items-center mb-6">
                <h1
                  class="text-2xl font-bold {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                >
                  <i class="fa-solid fa-list-check mr-2"></i>
                  {{ 'Data Konfigurasi Seleksi' if current_lang == 'id' else
                  'Selection Configuration Data' }}
                </h1>
                <div class="flex gap-2">
                  <button
                    x-show="selectedItems.length > 0"
                    @click="confirmBulkDelete()"
                    class="px-4 py-2 rounded-lg cursor-pointer bg-red-500 hover:bg-red-600 text-white transition"
                  >
                    <i class="fa-solid fa-trash mr-2"></i>
                    {{ 'Hapus Banyak' if current_lang == 'id' else 'Delete
                    Selected' }} (<span x-text="selectedItems.length"></span>)
                  </button>
                  <button
                    @click="window.location.href='/admin/manajemen_seleksi'"
                    class="px-4 py-2 rounded-lg cursor-pointer {{ 'bg-gray-300 hover:bg-gray-800 dark:bg-gray-700' if current_theme == 'dark' else 'bg-gray-200 hover:bg-gray-500 dark:bg-gray-400' }}"
                  >
                    <i class="fa-solid fa-arrow-left mr-2"></i>
                    {{ 'Kembali' if current_lang == 'id' else 'Back' }}
                  </button>
                </div>
              </div>

              <!-- Select All Controls -->
              <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-3">
                  <label class="flex items-center cursor-pointer">
                    <input
                      type="checkbox"
                      @change="toggleSelectAll($event.target.checked)"
                      :checked="selectedItems.length === events.length && events.length > 0"
                      class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 {{ 'bg-gray-700 border-gray-600' if current_theme == 'dark' else 'bg-white border-gray-300' }}"
                    />
                    <span
                      class="ml-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                    >
                      {{ 'Pilih Semua' if current_lang == 'id' else 'Select All'
                      }}
                    </span>
                  </label>
                  <span
                    x-show="selectedItems.length > 0"
                    class="px-3 py-1 rounded-full text-sm {{ 'bg-blue-500 text-white' if current_theme == 'dark' else 'bg-blue-100 text-blue-800' }}"
                  >
                    <span x-text="selectedItems.length"></span>
                    {{ ' dipilih' if current_lang == 'id' else ' selected' }}
                  </span>
                </div>
              </div>

              <!-- List Konfigurasi -->
              <div
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6"
              >
                {% for event in events %}
                <div
                  class="bg-white shadow-md rounded-xl p-6 hover:shadow-lg transition {{ 'dark:bg-gray-900' if current_theme == 'dark' else 'dark:bg-gray-100' }}"
                  :class="{ 'ring-2 ring-blue-500': selectedItems.includes({{ event.id_kegiatan }}) }"
                >
                  <div class="flex items-start justify-between mb-4">
                    <div class="flex items-start gap-3 flex-1">
                      <input
                        type="checkbox"
                        :checked="selectedItems.includes({{ event.id_kegiatan }})"
                        @change="toggleSelectItem({{ event.id_kegiatan }}, $event.target.checked)"
                        @click.stop
                        class="mt-1 w-5 h-5 text-blue-600 rounded focus:ring-blue-500 {{ 'bg-gray-700 border-gray-600' if current_theme == 'dark' else 'bg-white border-gray-300' }}"
                      />
                      <div
                        class="flex-1 cursor-pointer"
                        @click="loadConfig({{ event.id_kegiatan }})"
                      >
                        <h3
                          class="text-lg font-semibold mb-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                        >
                          {{ event.nama_kegiatan }}
                        </h3>
                        <div class="flex flex-wrap gap-2 mb-2">
                          <span
                            class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"
                          >
                            {{ event.jenis_kegiatan }}
                          </span>
                          <span
                            class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"
                          >
                            {{ event.skala_kegiatan }}
                          </span>
                        </div>
                      </div>
                    </div>
                    <div class="flex gap-2 ml-2">
                      <button
                        @click.stop="loadConfig({{ event.id_kegiatan }}, 'edit')"
                        class="p-2 text-blue-500 hover:bg-blue-100 hover:-translate-y-0.5 hover:shadow-md rounded-lg transition transform cursor-pointer"
                        title="{{ 'Edit' if current_lang == 'id' else 'Edit' }}"
                      >
                        <i class="fa-solid fa-edit"></i>
                      </button>
                      <button
                        @click.stop="confirmDelete({{ event.id_kegiatan }})"
                        class="p-2 text-red-500 hover:bg-red-100 hover:-translate-y-0.5 hover:shadow-md rounded-lg transition transform cursor-pointer"
                        title="{{ 'Hapus' if current_lang == 'id' else 'Delete' }}"
                      >
                        <i class="fa-solid fa-trash"></i>
                      </button>
                    </div>
                  </div>
                  <div
                    class="text-sm {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }} cursor-pointer"
                    @click="loadConfig({{ event.id_kegiatan }})"
                  >
                    <p class="mb-1">
                      <i class="fa-solid fa-calendar mr-2"></i>
                      {% if event.mulai %} {{ event.mulai.strftime('%d/%m/%Y')
                      }} {% if event.selesai %} - {{
                      event.selesai.strftime('%d/%m/%Y') }}{% endif %} {% else
                      %} - {% endif %}
                    </p>
                    <p>
                      <i class="fa-solid fa-location-dot mr-2"></i>
                      {{ event.tempat_pelaksanaan or '-' }}
                    </p>
                  </div>
                </div>
                {% endfor %}
              </div>

              <!-- Detail Modal -->
              <div
                x-show="selectedEvent !== null && configData !== null"
                x-transition.opacity
                class="fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm {{ 'bg-black/50' if current_theme == 'dark' else 'bg-gray-300/50' }}"
                @click.away="selectedEvent = null; configData = null"
              >
                <div
                  x-transition.scale
                  class="p-6 rounded-2xl shadow-2xl w-[85%] max-w-5xl flex flex-col bg-white"
                  style="max-height: 90vh; height: 90vh"
                >
                  <!-- Header -->
                  <div
                    class="flex justify-between items-center mb-3 flex-shrink-0 pb-3 border-b {{ 'border-gray-700' if current_theme == 'dark' else 'border-gray-300' }}"
                  >
                    <h2
                      class="text-lg font-bold {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                    >
                      <span x-show="!editMode"
                        >{{ 'Detail Konfigurasi Seleksi' if current_lang == 'id'
                        else 'Configuration Details' }}</span
                      >
                      <span x-show="editMode"
                        >{{ 'Edit Konfigurasi Seleksi' if current_lang == 'id'
                        else 'Edit Configuration' }}</span
                      >
                    </h2>
                    <div class="flex gap-2">
                      <button
                        x-show="!editMode"
                        @click="openEdit()"
                        class="px-3 py-1 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition cursor-pointer"
                        title="{{ 'Edit' if current_lang == 'id' else 'Edit' }}"
                      >
                        <i class="fa-solid fa-edit mr-1"></i>
                        {{ 'Edit' if current_lang == 'id' else 'Edit' }}
                      </button>
                      <button
                        x-show="!editMode"
                        @click="confirmDelete(selectedEvent)"
                        class="px-3 py-1 text-sm bg-red-500 hover:bg-red-600 text-white rounded-lg transition cursor-pointer"
                        title="{{ 'Hapus' if current_lang == 'id' else 'Delete' }}"
                      >
                        <i class="fa-solid fa-trash mr-1"></i>
                        {{ 'Hapus' if current_lang == 'id' else 'Delete' }}
                      </button>
                      <button
                        @click="selectedEvent = null; configData = null; editMode = false"
                        class="text-gray-500 hover:text-gray-700 dark:hover:text-red-600 transition cursor-pointer"
                      >
                        <i class="fa-solid fa-xmark text-2xl"></i>
                      </button>
                    </div>
                  </div>

                  <!-- Scrollable Content -->
                  <div
                    class="flex-1 overflow-y-auto overflow-x-hidden"
                    style="min-height: 0; max-height: 100%"
                  >
                    <div class="pr-2">
                      <template x-if="configData && !editMode">
                        <div class="space-y-4 pb-2">
                          <!-- Informasi Kegiatan -->
                          <div
                            class="border rounded-lg p-4 {{ 'border-gray-700' if current_theme == 'dark' else 'border-gray-300' }}"
                          >
                            <h3
                              class="text-lg font-semibold mb-4 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                            >
                              <i
                                class="fa-solid fa-info-circle mr-2 text-blue-500"
                              ></i>
                              {{ 'Informasi Kegiatan' if current_lang == 'id'
                              else 'Activity Information' }}
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div>
                                <label
                                  class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                                >
                                  {{ 'Nama Kegiatan' if current_lang == 'id'
                                  else 'Activity Name' }}
                                </label>
                                <p
                                  class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                  x-text="configData.event.nama_kegiatan"
                                ></p>
                              </div>
                              <div>
                                <label
                                  class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                                >
                                  {{ 'Jenis Kegiatan' if current_lang == 'id'
                                  else 'Activity Type' }}
                                </label>
                                <p
                                  class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                  x-text="configData.event.jenis_kegiatan"
                                ></p>
                              </div>
                              <div>
                                <label
                                  class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                                >
                                  {{ 'Skala Kegiatan' if current_lang == 'id'
                                  else 'Activity Scale' }}
                                </label>
                                <p
                                  class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                  x-text="configData.event.skala_kegiatan"
                                ></p>
                              </div>
                              <div>
                                <label
                                  class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                                >
                                  {{ 'Kwartir Penyelenggara' if current_lang ==
                                  'id' else 'Organizing Kwartir' }}
                                </label>
                                <p
                                  class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                  x-text="configData.event.kwartir_penyelenggara"
                                ></p>
                              </div>
                              <div>
                                <label
                                  class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                                >
                                  {{ 'Tempat Pelaksanaan' if current_lang ==
                                  'id' else 'Location' }}
                                </label>
                                <p
                                  class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                  x-text="configData.event.tempat_pelaksanaan"
                                ></p>
                              </div>
                              <div>
                                <label
                                  class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                                >
                                  {{ 'Waktu Pelaksanaan' if current_lang == 'id'
                                  else 'Execution Time' }}
                                </label>
                                <p
                                  class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                >
                                  <span
                                    x-text="configData.event.waktu_pelaksanaan_dimulai ? new Date(configData.event.waktu_pelaksanaan_dimulai).toLocaleDateString('id-ID') : '-'"
                                  ></span>
                                  <span
                                    x-show="configData.event.waktu_pelaksanaan_selesai && configData.event.waktu_pelaksanaan_selesai !== configData.event.waktu_pelaksanaan_dimulai"
                                  >
                                    -
                                    <span
                                      x-text="new Date(configData.event.waktu_pelaksanaan_selesai).toLocaleDateString('id-ID')"
                                    ></span>
                                  </span>
                                </p>
                              </div>
                              <div>
                                <label
                                  class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                                >
                                  {{ 'Periode Seleksi' if current_lang == 'id'
                                  else 'Selection Period' }}
                                </label>
                                <p
                                  class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                >
                                  <span
                                    x-text="configData.event.mulai ? new Date(configData.event.mulai).toLocaleDateString('id-ID') : '-'"
                                  ></span>
                                  <span x-show="configData.event.selesai">
                                    -
                                    <span
                                      x-text="new Date(configData.event.selesai).toLocaleDateString('id-ID')"
                                    ></span
                                  ></span>
                                </p>
                              </div>
                            </div>
                          </div>

                          <!-- Komposisi Kontingen -->
                          <div
                            class="border rounded-lg p-4 {{ 'border-gray-700' if current_theme == 'dark' else 'border-gray-300' }}"
                          >
                            <h3
                              class="text-lg font-semibold mb-4 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                            >
                              <i
                                class="fa-solid fa-users mr-2 text-green-500"
                              ></i>
                              {{ 'Komposisi Kontingen' if current_lang == 'id'
                              else 'Contingent Composition' }}
                            </h3>
                            <div class="grid grid-cols-2 gap-4">
                              <div>
                                <label
                                  class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                                >
                                  {{ 'Umpi Putra' if current_lang == 'id' else
                                  'Male Umpi' }}
                                </label>
                                <p
                                  class="text-2xl font-bold {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                  x-text="configData.kuota.putra"
                                ></p>
                              </div>
                              <div>
                                <label
                                  class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                                >
                                  {{ 'Umpi Putri' if current_lang == 'id' else
                                  'Female Umpi' }}
                                </label>
                                <p
                                  class="text-2xl font-bold {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                  x-text="configData.kuota.putri"
                                ></p>
                              </div>
                            </div>
                          </div>

                          <!-- Kriteria Seleksi -->
                          <div
                            class="border rounded-lg p-4 {{ 'border-gray-700' if current_theme == 'dark' else 'border-gray-300' }}"
                          >
                            <h3
                              class="text-lg font-semibold mb-4 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                            >
                              <i
                                class="fa-solid fa-list-check mr-2 text-purple-500"
                              ></i>
                              {{ 'Kriteria Seleksi' if current_lang == 'id' else
                              'Selection Criteria' }}
                            </h3>
                            <div class="overflow-x-auto">
                              <table class="w-full text-sm">
                                <thead
                                  class="{{ 'bg-gray-800' if current_theme == 'dark' else 'bg-gray-200' }}"
                                >
                                  <tr>
                                    <th
                                      class="px-4 py-3 text-left {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                    >
                                      {{ 'Nama Kriteria' if current_lang == 'id'
                                      else 'Criteria Name' }}
                                    </th>
                                    <th
                                      class="px-4 py-3 text-left {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                    >
                                      {{ 'Jenis' if current_lang == 'id' else
                                      'Type' }}
                                    </th>
                                    <th
                                      class="px-4 py-3 text-left {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                    >
                                      {{ 'Skala' if current_lang == 'id' else
                                      'Scale' }}
                                    </th>
                                    <th
                                      class="px-4 py-3 text-left {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                    >
                                      {{ 'Aspek' if current_lang == 'id' else
                                      'Aspect' }}
                                    </th>
                                    <th
                                      class="px-4 py-3 text-left {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                    >
                                      {{ 'Jumlah Soal' if current_lang == 'id'
                                      else 'Question Count' }}
                                    </th>
                                  </tr>
                                </thead>
                                <tbody
                                  class="divide-y {{ 'divide-gray-700' if current_theme == 'dark' else 'divide-gray-300' }}"
                                >
                                  <template
                                    x-for="(crit, index) in configData.criteria"
                                    :key="index"
                                  >
                                    <tr
                                      class="{{ 'hover:bg-gray-800' if current_theme == 'dark' else 'hover:bg-gray-100' }}"
                                    >
                                      <td
                                        class="px-4 py-3 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                        x-text="crit.nama_kriteria"
                                      ></td>
                                      <td
                                        class="px-4 py-3 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                        x-text="crit.jenis_kriteria"
                                      ></td>
                                      <td
                                        class="px-4 py-3 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                        x-text="crit.bobot"
                                      ></td>
                                      <td
                                        class="px-4 py-3 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                        x-text="crit.aspek || '-'"
                                      ></td>
                                      <td
                                        class="px-4 py-3 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                        x-text="crit.jumlah_soal ? crit.jumlah_soal : '-'"
                                      ></td>
                                    </tr>
                                  </template>
                                  <tr
                                    x-show="!configData.criteria || configData.criteria.length === 0"
                                  >
                                    <td
                                      colspan="5"
                                      class="px-4 py-8 text-center {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                                    >
                                      {{ 'Tidak ada kriteria' if current_lang ==
                                      'id' else 'No criteria' }}
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </div>
                        </div>
                      </template>

                      <!-- Form Edit -->
                      <template x-if="editData && editMode">
                        <div class="space-y-4 pb-2">
                          <!-- Informasi Kegiatan -->
                          <div
                            class="border rounded-lg p-4 mb-4 {{ 'border-gray-700' if current_theme == 'dark' else 'border-gray-300' }}"
                          >
                            <h3
                              class="font-semibold mb-4 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                            >
                              {{ 'Informasi Kegiatan' if current_lang == 'id'
                              else 'Activity Information' }}
                            </h3>

                            <!-- Nama Kegiatan -->
                            <label
                              class="block text-sm font-medium mb-1 mt-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                            >
                              {{ 'Nama Kegiatan' if current_lang == 'id' else
                              'Activity Name' }}
                            </label>
                            <input
                              type="text"
                              x-model="editData.event.nama_kegiatan"
                              class="w-full mb-2 rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                            />

                            <!-- Skala Kegiatan -->
                            <label
                              class="block text-sm font-medium mb-1 mt-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                            >
                              {{ 'Skala Kegiatan' if current_lang == 'id' else
                              'Activity Scale' }}
                            </label>
                            <select
                              x-model="editData.event.skala_kegiatan"
                              class="w-full mb-2 rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                            >
                              <option value="Ranting">Ranting</option>
                              <option value="Cabang">Cabang</option>
                              <option value="Daerah">Daerah</option>
                              <option value="Nasional">Nasional</option>
                              <option value="Internasional">
                                Internasional
                              </option>
                            </select>

                            <!-- Jenis Kegiatan -->
                            <label
                              class="block text-sm font-medium mb-1 mt-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                            >
                              {{ 'Jenis Kegiatan' if current_lang == 'id' else
                              'Activity Type' }}
                            </label>
                            <select
                              x-model="editData.event.jenis_kegiatan"
                              class="w-full mb-2 rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                            >
                              <option value="Siaga">Siaga</option>
                              <option value="Penggalang">Penggalang</option>
                              <option value="Penegak">Penegak</option>
                              <option value="Pandega">Pandega</option>
                              <option value="Penegak dan Pandega">
                                Penegak dan Pandega
                              </option>
                            </select>

                            <!-- Kwartir Penyelenggara -->
                            <label
                              class="block text-sm font-medium mb-1 mt-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                            >
                              {{ 'Kwartir Penyelenggara' if current_lang == 'id'
                              else 'Organizing Kwartir' }}
                            </label>
                            <input
                              type="text"
                              x-model="editData.event.kwartir_penyelenggara"
                              class="w-full mb-2 rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                            />

                            <!-- Waktu Pelaksanaan -->
                            <label
                              class="block text-sm font-medium mb-1 mt-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                            >
                              {{ 'Waktu Pelaksanaan' if current_lang == 'id'
                              else 'Execution Time' }}
                            </label>
                            <div class="flex gap-3">
                              <div class="w-1/2">
                                <small
                                  class="{{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-700' }}"
                                  >{{ 'Mulai' if current_lang == 'id' else
                                  'Start' }}</small
                                >
                                <input
                                  type="date"
                                  :value="editData.event.waktu_pelaksanaan_dimulai ? (editData.event.waktu_pelaksanaan_dimulai.includes('T') ? editData.event.waktu_pelaksanaan_dimulai.split('T')[0] : editData.event.waktu_pelaksanaan_dimulai) : ''"
                                  @input="editData.event.waktu_pelaksanaan_dimulai = $event.target.value"
                                  class="w-full rounded-lg mb-2 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                                />
                              </div>
                              <div class="w-1/2">
                                <small
                                  class="{{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-700' }}"
                                  >{{ 'Selesai' if current_lang == 'id' else
                                  'End' }}</small
                                >
                                <input
                                  type="date"
                                  :value="editData.event.waktu_pelaksanaan_selesai ? (editData.event.waktu_pelaksanaan_selesai.includes('T') ? editData.event.waktu_pelaksanaan_selesai.split('T')[0] : editData.event.waktu_pelaksanaan_selesai) : ''"
                                  @input="editData.event.waktu_pelaksanaan_selesai = $event.target.value"
                                  class="w-full rounded-lg mb-2 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                                />
                              </div>
                            </div>

                            <!-- Tempat Pelaksanaan -->
                            <label
                              class="block text-sm font-medium mb-1 mt-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                            >
                              {{ 'Tempat Pelaksanaan' if current_lang == 'id'
                              else 'Location' }}
                            </label>
                            <input
                              type="text"
                              x-model="editData.event.tempat_pelaksanaan"
                              class="w-full mb-2 rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                            />

                            <!-- Periode Seleksi -->
                            <label
                              class="block text-sm font-medium mb-1 mt-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                            >
                              {{ 'Periode Seleksi' if current_lang == 'id' else
                              'Selection Period' }}
                            </label>
                            <div class="flex gap-3">
                              <div class="w-1/2">
                                <small
                                  class="{{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-700' }}"
                                  >{{ 'Mulai' if current_lang == 'id' else
                                  'Start' }}</small
                                >
                                <input
                                  type="date"
                                  :value="editData.event.mulai ? (editData.event.mulai.includes('T') ? editData.event.mulai.split('T')[0] : editData.event.mulai) : ''"
                                  @input="editData.event.mulai = $event.target.value"
                                  class="w-full rounded-lg mb-2 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                                />
                              </div>
                              <div class="w-1/2">
                                <small
                                  class="{{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-700' }}"
                                  >{{ 'Selesai' if current_lang == 'id' else
                                  'End' }}</small
                                >
                                <input
                                  type="date"
                                  :value="editData.event.selesai ? (editData.event.selesai.includes('T') ? editData.event.selesai.split('T')[0] : editData.event.selesai) : ''"
                                  @input="editData.event.selesai = $event.target.value"
                                  class="w-full rounded-lg mb-2 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                                />
                              </div>
                            </div>
                          </div>

                          <!-- Komposisi Kontingen -->
                          <div
                            class="border rounded-lg p-4 mb-4 {{ 'border-gray-700' if current_theme == 'dark' else 'border-gray-300' }}"
                          >
                            <h3
                              class="font-semibold mb-4 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                            >
                              {{ 'Komposisi Kontingen' if current_lang == 'id'
                              else 'Contingent Composition' }}
                            </h3>
                            <div class="flex gap-3">
                              <div class="w-1/2">
                                <label
                                  class="block text-sm font-medium mb-1 mt-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                >
                                  {{ 'Umpi Putra' if current_lang == 'id' else
                                  'Male Umpi' }}
                                </label>
                                <input
                                  type="number"
                                  x-model.number="editData.kuota.putra"
                                  class="w-full mb-2 rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                                />
                              </div>
                              <div class="w-1/2">
                                <label
                                  class="block text-sm font-medium mb-1 mt-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                                >
                                  {{ 'Umpi Putri' if current_lang == 'id' else
                                  'Female Umpi' }}
                                </label>
                                <input
                                  type="number"
                                  x-model.number="editData.kuota.putri"
                                  class="w-full mb-2 rounded-lg {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-300 dark:bg-gray-300 dark:text-gray-900' }}"
                                />
                              </div>
                            </div>
                          </div>

                          <!-- Kriteria Seleksi -->
                          <div
                            class="border rounded-lg p-4 mb-4 {{ 'border-gray-700' if current_theme == 'dark' else 'border-gray-300' }}"
                          >
                            <h3
                              class="font-semibold mb-4 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                            >
                              {{ 'Kriteria Seleksi' if current_lang == 'id' else
                              'Selection Criteria' }}
                            </h3>

                            <!-- Table Header -->
                            <div
                              class="flex items-center gap-2 mb-2 font-semibold text-sm border-b pb-2 {{ 'text-white border-gray-700' if current_theme == 'dark' else 'text-gray-900 border-gray-300' }}"
                            >
                              <div class="w-1/3">
                                {{ 'Nama Kriteria' if current_lang == 'id' else
                                'Criteria Name' }}
                              </div>
                              <div class="w-1/3 pl-3">
                                {{ 'Jenis Penilaian' if current_lang == 'id'
                                else 'Type of Assessment' }}
                              </div>
                              <div class="w-1/3 pl-3">
                                {{ 'Skala Penilaian' if current_lang == 'id'
                                else 'Assessment Scale' }}
                              </div>
                              <div class="w-12 text-center">
                                {{ 'Aksi' if current_lang == 'id' else 'Action'
                                }}
                              </div>
                            </div>

                            <!-- Table Rows -->
                            <div class="space-y-2">
                              <template
                                x-for="(crit, index) in editData.criteria"
                                :key="index"
                              >
                                <div class="flex items-center gap-2 mb-2">
                                  <!-- Nama Kriteria -->
                                  <input
                                    type="text"
                                    x-model="crit.nama_kriteria"
                                    class="w-1/3 rounded-lg px-2 py-1 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-600 dark:bg-gray-300 dark:text-gray-900' }}"
                                  />

                                  <!-- Jenis Penilaian -->
                                  <div
                                    class="w-1/3 flex relative group items-center justify-between border px-2 py-1 rounded-lg {{ 'dark:bg-gray-800 dark:text-white border-gray-600' if current_theme == 'dark' else 'dark:bg-gray-300 dark:text-gray-900 border-gray-300' }}"
                                  >
                                    <span
                                      class="text-sm"
                                      x-text="crit.jenis_kriteria || 'Belum diatur'"
                                    ></span>
                                    <button
                                      @click="openEditCriteria(index)"
                                      class="px-2 py-1 bg-yellow-500 hover:bg-amber-500 text-white rounded text-xs cursor-pointer"
                                      title="{{ 'Edit' if current_lang == 'id' else 'Edit' }}"
                                    >
                                      <i class="fa-solid fa-pen-to-square"></i>
                                    </button>
                                  </div>

                                  <!-- Skala Penilaian (Bobot) -->
                                  <div class="flex items-center w-1/3">
                                    <input
                                      type="number"
                                      step="0.01"
                                      x-model.number="crit.bobot"
                                      min="0"
                                      max="10"
                                      placeholder="0-10"
                                      class="w-full rounded-lg px-2 py-1 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-600 dark:bg-gray-300 dark:text-gray-900' }}"
                                    />
                                  </div>

                                  <!-- Hapus -->
                                  <button
                                    @click="deleteCriteria(index)"
                                    class="px-2 py-1 bg-red-500 hover:bg-red-700 text-white rounded-lg text-xs cursor-pointer"
                                    title="{{ 'Hapus' if current_lang == 'id' else 'Delete' }}"
                                  >
                                    <i class="fa-solid fa-trash"></i>
                                  </button>
                                </div>
                              </template>
                            </div>

                            <!-- Tambah Kriteria -->
                            <button
                              @click="addCriteria()"
                              class="px-3 py-1 bg-green-500 hover:bg-green-700 text-white rounded-lg text-sm mt-3 cursor-pointer"
                            >
                              <i class="fa-solid fa-plus mr-1"></i>
                              {{ '+ Tambah Kriteria' if current_lang == 'id'
                              else '+ Add Criteria' }}
                            </button>
                          </div>
                        </div>
                      </template>
                    </div>
                  </div>

                  <!-- Action Buttons (Fixed at bottom) -->
                  <div
                    x-show="editMode"
                    class="flex justify-end gap-3 pt-3 mt-3 border-t flex-shrink-0 {{ 'border-gray-700' if current_theme == 'dark' else 'border-gray-300' }}"
                  >
                    <button
                      @click="cancelEdit()"
                      class="px-4 py-2 border rounded-lg {{ 'border-gray-600 text-gray-300 hover:bg-gray-700' if current_theme == 'dark' else 'border-gray-300 text-gray-700 hover:bg-gray-100' }} transition"
                    >
                      {{ 'Batal' if current_lang == 'id' else 'Cancel' }}
                    </button>
                    <button
                      @click="saveEdit()"
                      :disabled="loading"
                      class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition disabled:opacity-50"
                    >
                      <span x-show="!loading"
                        >{{ 'Simpan' if current_lang == 'id' else 'Save'
                        }}</span
                      >
                      <span x-show="loading"
                        >{{ 'Menyimpan...' if current_lang == 'id' else
                        'Saving...' }}</span
                      >
                    </button>
                  </div>
                </div>
              </div>

              <!-- Modal Konfirmasi Hapus -->
              <div
                x-show="showDeleteModal"
                x-transition.opacity
                class="fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm {{ 'bg-black/50' if current_theme == 'dark' else 'bg-gray-300/50' }}"
                @click.away="showDeleteModal = false"
              >
                <div
                  x-transition.scale
                  class="p-6 rounded-2xl shadow-2xl w-11/12 max-w-md bg-white {{ 'dark:bg-gray-900' if current_theme == 'dark' else 'dark:bg-gray-200' }}"
                >
                  <h3
                    class="text-xl font-bold mb-4 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                  >
                    {{ 'Konfirmasi Hapus' if current_lang == 'id' else 'Confirm
                    Delete' }}
                  </h3>
                  <p
                    class="mb-6 {{ 'text-gray-300' if current_theme == 'dark' else 'text-gray-700' }}"
                  >
                    <span x-show="!isBulkDelete">
                      {{ 'Apakah Anda yakin ingin menghapus konfigurasi ini?
                      Tindakan ini tidak dapat dibatalkan.' if current_lang ==
                      'id' else 'Are you sure you want to delete this
                      configuration? This action cannot be undone.' }}
                    </span>
                    <span x-show="isBulkDelete">
                      {{ 'Apakah Anda yakin ingin menghapus' if current_lang ==
                      'id' else 'Are you sure you want to delete' }}
                      <strong x-text="selectedItems.length"></strong>
                      {{ 'konfigurasi yang dipilih? Tindakan ini tidak dapat
                      dibatalkan.' if current_lang == 'id' else 'selected
                      configurations? This action cannot be undone.' }}
                    </span>
                  </p>
                  <div class="flex justify-end gap-3">
                    <button
                      @click="showDeleteModal = false; deleteEventId = null; isBulkDelete = false"
                      class="px-4 py-2 border rounded-lg {{ 'border-gray-600 text-gray-300 hover:bg-gray-700' if current_theme == 'dark' else 'border-gray-300 text-gray-700 hover:bg-gray-100' }} transition"
                    >
                      {{ 'Batal' if current_lang == 'id' else 'Cancel' }}
                    </button>
                    <button
                      @click="isBulkDelete ? deleteBulkConfig() : deleteConfig()"
                      :disabled="loading"
                      class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition disabled:opacity-50"
                    >
                      <span x-show="!loading"
                        >{{ 'Hapus' if current_lang == 'id' else 'Delete'
                        }}</span
                      >
                      <span x-show="loading"
                        >{{ 'Menghapus...' if current_lang == 'id' else
                        'Deleting...' }}</span
                      >
                    </button>
                  </div>
                </div>
              </div>

              <!-- Modal Edit Kriteria -->
              <div
                x-show="showCriteriaModal"
                x-transition.opacity
                class="fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm {{ 'bg-black/50' if current_theme == 'dark' else 'bg-gray-300/50' }}"
                @click.away="showCriteriaModal = false"
              >
                <div
                  x-transition.scale
                  class="p-6 rounded-2xl shadow-2xl w-96 flex flex-col items-center relative bg-white {{ 'dark:bg-gray-900' if current_theme == 'dark' else 'dark:bg-gray-200' }}"
                >
                  <!-- Tombol Close -->
                  <button
                    @click="showCriteriaModal = false"
                    class="absolute top-3 right-3 dark:hover:text-red-600 transition cursor-pointer {{ 'text-gray-500 hover:text-gray-700' if current_theme == 'dark' else 'text-gray-800 hover:text-gray-900' }}"
                    aria-label="Close"
                  >
                    <i class="fa-solid fa-xmark text-lg"></i>
                  </button>

                  <!-- Icon -->
                  <div
                    class="text-3xl mb-2 animate-bounce {{ 'text-amber-400' if current_theme == 'dark' else 'text-amber-600' }}"
                  >
                    <i class="fa-solid fa-chart-pie"></i>
                  </div>

                  <h4
                    class="font-semibold mb-4 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                  >
                    {{ 'Atur Jenis Penilaian' if current_lang == 'id' else 'Set
                    Assessment Type' }}
                  </h4>

                  <template
                    x-if="selectedCriteriaIndex !== null && editData.criteria[selectedCriteriaIndex]"
                  >
                    <div class="w-full space-y-4">
                      <!-- Jenis Kriteria -->
                      <div>
                        <label
                          class="block mb-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                        >
                          {{ 'Jenis Kriteria' if current_lang == 'id' else
                          'Criteria Type' }}
                        </label>
                        <select
                          x-model="editData.criteria[selectedCriteriaIndex].jenis_kriteria"
                          class="w-full rounded-lg px-3 py-2 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-600 dark:bg-gray-300 dark:text-gray-900' }}"
                        >
                          <option value="Kualitatif">
                            {{ 'Kualitatif' if current_lang == 'id' else
                            'Qualitative' }}
                          </option>
                          <option value="Kuantitatif">
                            {{ 'Kuantitatif' if current_lang == 'id' else
                            'Quantitative' }}
                          </option>
                        </select>
                      </div>

                      <!-- Jumlah Soal (jika Kuantitatif) -->
                      <div
                        x-show="editData.criteria[selectedCriteriaIndex].jenis_kriteria === 'Kuantitatif'"
                      >
                        <label
                          class="block mb-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                        >
                          {{ 'Jumlah Soal' if current_lang == 'id' else 'Number
                          of Questions' }}
                        </label>
                        <input
                          type="number"
                          x-model.number="editData.criteria[selectedCriteriaIndex].jumlah_soal"
                          min="1"
                          class="w-full rounded-lg px-3 py-2 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-600 dark:bg-gray-300 dark:text-gray-900' }}"
                        />
                      </div>

                      <!-- Aspek -->
                      <div>
                        <label
                          class="block mb-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                        >
                          {{ 'Aspek' if current_lang == 'id' else 'Aspect' }}
                        </label>
                        <input
                          type="text"
                          x-model="editData.criteria[selectedCriteriaIndex].aspek"
                          class="w-full rounded-lg px-3 py-2 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-600 dark:bg-gray-300 dark:text-gray-900' }}"
                        />
                      </div>

                      <!-- Deskripsi -->
                      <div>
                        <label
                          class="block mb-2 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                        >
                          {{ 'Deskripsi' if current_lang == 'id' else
                          'Description' }}
                        </label>
                        <textarea
                          x-model="editData.criteria[selectedCriteriaIndex].deskripsi"
                          rows="3"
                          class="w-full rounded-lg px-3 py-2 {{ 'border-gray-300 dark:bg-gray-800 dark:text-white' if current_theme == 'dark' else 'border-gray-600 dark:bg-gray-300 dark:text-gray-900' }}"
                        ></textarea>
                      </div>
                    </div>
                  </template>

                  <div class="mt-6 flex justify-end gap-3 w-full">
                    <button
                      type="button"
                      @click="showCriteriaModal = false"
                      class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white transition rounded-lg cursor-pointer"
                    >
                      <i class="fa-solid fa-xmark"></i>
                      {{ 'Batal' if current_lang == 'id' else 'Cancel' }}
                    </button>
                    <button
                      @click="showCriteriaModal = false"
                      class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white transition rounded-lg cursor-pointer"
                    >
                      <i class="fa-solid fa-floppy-disk"></i>
                      {{ 'Simpan' if current_lang == 'id' else 'Save' }}
                    </button>
                  </div>
                </div>
              </div>

              <!-- Empty State -->
              {% if not events %}
              <div class="text-center py-12">
                <i
                  class="fa-solid fa-inbox text-6xl {{ 'text-gray-600' if current_theme == 'dark' else 'text-gray-400' }} mb-4"
                ></i>
                <p
                  class="text-lg {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                >
                  {{ 'Belum ada konfigurasi seleksi' if current_lang == 'id'
                  else 'No selection configuration yet' }}
                </p>
              </div>
              {% endif %}
            </div>
          </section>
        </main>
      </div>
    </div>
  </body>

  <style>
    /* Custom Scrollbar untuk Modal */
    .overflow-y-auto::-webkit-scrollbar {
      width: 10px;
    }
    .overflow-y-auto::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
      border-radius: 5px;
    }
    .overflow-y-auto::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 5px;
    }
    .overflow-y-auto::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 0, 0, 0.6);
    }
    /* Dark mode scrollbar */
    .dark .overflow-y-auto::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
    }
    .dark .overflow-y-auto::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.4);
    }
    .dark .overflow-y-auto::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.6);
    }
    /* Ensure scrollable area works */
    .flex-1.overflow-y-auto {
      overscroll-behavior: contain;
    }
  </style>

  <script>
    document.addEventListener("alpine:init", () => {
      Alpine.data("viewConfigData", () => ({
        ready: false,
        current_lang: "{{ current_lang }}",
        selectedEvent: null,
        configData: null,
        editData: null,
        loading: false,
        editMode: false,
        deleteEventId: null,
        showDeleteModal: false,
        isBulkDelete: false,
        selectedItems: [],
        events: [
          {% for event in events %}
          {
            id: {{ event.id_kegiatan }},
            nama: "{{ event.nama_kegiatan }}"
          }{% if not loop.last %},{% endif %}
          {% endfor %}
        ],
        modal: { show: false, title: "", message: "" },
        pendingAction: null,

        init() {
          this.ready = true;
        },

        toggleSelectItem(eventId, checked) {
          if (checked) {
            if (!this.selectedItems.includes(eventId)) {
              this.selectedItems.push(eventId);
            }
          } else {
            this.selectedItems = this.selectedItems.filter(id => id !== eventId);
          }
        },

        toggleSelectAll(checked) {
          if (checked) {
            this.selectedItems = this.events.map(e => e.id);
          } else {
            this.selectedItems = [];
          }
        },

        confirmBulkDelete() {
          if (this.selectedItems.length === 0) return;
          this.isBulkDelete = true;
          this.showDeleteModal = true;
        },

        loadConfig(eventId, action = null) {
          this.loading = true;
          this.selectedEvent = eventId;
          this.configData = null;
          this.editMode = false;
          this.pendingAction = action;

          fetch(`/api/get_config/${eventId}`)
            .then((res) => res.json())
            .then((data) => {
              if (data.status === "success") {
                this.configData = data.data;
                this.editData = JSON.parse(JSON.stringify(data.data));
                if (this.pendingAction === "edit") {
                  this.openEdit();
                }
                this.pendingAction = null;
              } else {
                this.modal = {
                  show: true,
                  title: "{{ 'Error' if current_lang == 'id' else 'Error' }}",
                  message:
                    data.message ||
                    "{{ 'Gagal memuat data konfigurasi' if current_lang == 'id' else 'Failed to load configuration data' }}",
                };
                this.selectedEvent = null;
                this.pendingAction = null;
              }
            })
            .catch((err) => {
              console.error("Error loading config:", err);
              this.modal = {
                show: true,
                title: "{{ 'Error' if current_lang == 'id' else 'Error' }}",
                message:
                  "{{ 'Terjadi kesalahan saat memuat data' if current_lang == 'id' else 'An error occurred while loading data' }}",
              };
              this.selectedEvent = null;
              this.pendingAction = null;
            })
            .finally(() => {
              this.loading = false;
            });
        },

        openEdit() {
          if (this.configData) {
            this.editData = JSON.parse(JSON.stringify(this.configData));
            this.editMode = true;
          }
        },

        cancelEdit() {
          this.editMode = false;
          this.editData = null;
        },

        addCriteria() {
          if (!this.editData.criteria) {
            this.editData.criteria = [];
          }
          this.editData.criteria.push({
            nama_kriteria: '',
            jenis_kriteria: 'Kualitatif',
            bobot: 1,
            jumlah_soal: null,
            aspek: '',
            deskripsi: ''
          });
        },

        deleteCriteria(index) {
          if (confirm('{{ 'Apakah Anda yakin ingin menghapus kriteria ini?' if current_lang == 'id' else 'Are you sure you want to delete this criteria?' }}')) {
            this.editData.criteria.splice(index, 1);
          }
        },

        openEditCriteria(index) {
          // Buka modal edit untuk kriteria
          this.selectedCriteriaIndex = index;
          this.showCriteriaModal = true;
        },

        selectedCriteriaIndex: null,
        showCriteriaModal: false,

        saveEdit() {
          if (!this.selectedEvent || !this.editData) return;

          this.loading = true;
          const csrfToken =
            document.querySelector("meta[name=csrf-token]")?.content || "";

          const dataToSend = JSON.parse(JSON.stringify(this.editData));

          if (
            dataToSend.event.waktu_pelaksanaan_dimulai &&
            dataToSend.event.waktu_pelaksanaan_dimulai.includes("T")
          ) {
            dataToSend.event.waktu_pelaksanaan_dimulai =
              dataToSend.event.waktu_pelaksanaan_dimulai.split("T")[0];
          }
          if (
            dataToSend.event.waktu_pelaksanaan_selesai &&
            dataToSend.event.waktu_pelaksanaan_selesai.includes("T")
          ) {
            dataToSend.event.waktu_pelaksanaan_selesai =
              dataToSend.event.waktu_pelaksanaan_selesai.split("T")[0];
          }
          if (dataToSend.event.mulai && dataToSend.event.mulai.includes("T")) {
            dataToSend.event.mulai = dataToSend.event.mulai.split("T")[0];
          }
          if (
            dataToSend.event.selesai &&
            dataToSend.event.selesai.includes("T")
          ) {
            dataToSend.event.selesai = dataToSend.event.selesai.split("T")[0];
          }

          fetch(`/api/update_config/${this.selectedEvent}`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-CSRFToken": csrfToken,
            },
            body: JSON.stringify(dataToSend),
          })
            .then((res) => res.json())
            .then((data) => {
              if (data.status === "success") {
                this.modal = {
                  show: true,
                  title:
                    "{{ 'Berhasil' if current_lang == 'id' else 'Success' }}",
                  message: data.message,
                };
                this.editMode = false;
                this.loadConfig(this.selectedEvent);
                setTimeout(() => {
                  window.location.reload();
                }, 1000);
              } else {
                this.modal = {
                  show: true,
                  title: "{{ 'Error' if current_lang == 'id' else 'Error' }}",
                  message:
                    data.message ||
                    "{{ 'Gagal memperbarui konfigurasi' if current_lang == 'id' else 'Failed to update configuration' }}",
                };
              }
            })
            .catch((err) => {
              console.error("Error updating config:", err);
              this.modal = {
                show: true,
                title: "{{ 'Error' if current_lang == 'id' else 'Error' }}",
                message:
                  "{{ 'Terjadi kesalahan saat memperbarui data' if current_lang == 'id' else 'An error occurred while updating data' }}",
              };
            })
            .finally(() => {
              this.loading = false;
            });
        },

        confirmDelete(eventId) {
          this.deleteEventId = eventId;
          this.showDeleteModal = true;
        },

        deleteConfig() {
          if (!this.deleteEventId) return;

          this.loading = true;
          const csrfToken =
            document.querySelector("meta[name=csrf-token]")?.content || "";

          fetch(`/api/delete_config/${this.deleteEventId}`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-CSRFToken": csrfToken,
            },
          })
            .then((res) => res.json())
            .then((data) => {
              if (data.status === "success") {
                this.modal = {
                  show: true,
                  title:
                    "{{ 'Berhasil' if current_lang == 'id' else 'Success' }}",
                  message: data.message,
                };
                this.showDeleteModal = false;
                this.deleteEventId = null;
                this.isBulkDelete = false;
                // Remove from selected items if it was selected
                this.selectedItems = this.selectedItems.filter(id => id !== this.deleteEventId);
                setTimeout(() => {
                  window.location.reload();
                }, 1000);
              } else {
                this.modal = {
                  show: true,
                  title: "{{ 'Error' if current_lang == 'id' else 'Error' }}",
                  message:
                    data.message ||
                    "{{ 'Gagal menghapus konfigurasi' if current_lang == 'id' else 'Failed to delete configuration' }}",
                };
              }
            })
            .catch((err) => {
              console.error("Error deleting config:", err);
              this.modal = {
                show: true,
                title: "{{ 'Error' if current_lang == 'id' else 'Error' }}",
                message:
                  "{{ 'Terjadi kesalahan saat menghapus data' if current_lang == 'id' else 'An error occurred while deleting data' }}",
              };
            })
            .finally(() => {
              this.loading = false;
            });
        },

        deleteBulkConfig() {
          if (this.selectedItems.length === 0) return;

          this.loading = true;
          const csrfToken =
            document.querySelector("meta[name=csrf-token]")?.content || "";

          fetch(`/api/delete_config_bulk`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-CSRFToken": csrfToken,
            },
            body: JSON.stringify({ event_ids: this.selectedItems }),
          })
            .then((res) => res.json())
            .then((data) => {
              if (data.status === "success") {
                this.modal = {
                  show: true,
                  title:
                    "{{ 'Berhasil' if current_lang == 'id' else 'Success' }}",
                  message: data.message,
                };
                this.showDeleteModal = false;
                this.isBulkDelete = false;
                this.selectedItems = [];
                setTimeout(() => {
                  window.location.reload();
                }, 1000);
              } else {
                this.modal = {
                  show: true,
                  title: "{{ 'Error' if current_lang == 'id' else 'Error' }}",
                  message:
                    data.message ||
                    "{{ 'Gagal menghapus konfigurasi' if current_lang == 'id' else 'Failed to delete configuration' }}",
                };
              }
            })
            .catch((err) => {
              console.error("Error deleting bulk config:", err);
              this.modal = {
                show: true,
                title: "{{ 'Error' if current_lang == 'id' else 'Error' }}",
                message:
                  "{{ 'Terjadi kesalahan saat menghapus data' if current_lang == 'id' else 'An error occurred while deleting data' }}",
              };
            })
            .finally(() => {
              this.loading = false;
            });
        },
      }));
    });
  </script>
</html>
