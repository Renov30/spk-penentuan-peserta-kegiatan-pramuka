<!DOCTYPE html>
<html
  class="transition duration-300 ease-in-out"
  lang="{{ current_lang }}"
  x-data
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    <title>
      {{ 'Dashboard Peserta | SPK Pramuka' if current_lang == 'id' else
      'Participant Dashboard | Scout DSS' }}
    </title>

    <!-- Tailwind CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/output.css') }}"
    />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
    />

    <!-- Alpine.js -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <!-- Script Sidebar -->
    {% include "script_sidebar.html" %}

    <!-- Script Theme -->
    {% include 'script_theme.html' %}
  </head>
  <body
    x-data="{ ready: false }"
    x-init="ready = true"
    :class="{ 'dark': $store.theme?.isDark }"
    x-bind:class="{
        'bg-background-dark text-white': $store.theme?.isDark,
        'bg-gray-100 text-black': !$store.theme?.isDark
      }"
    class="transition duration-300 ease-in-out font-sans scroll-smooth {{ 'bg-background-dark text-white' if current_theme == 'dark' else 'bg-gray-100 text-black' }}"
  >
    <div
      class="flex h-screen {{ 'bg-gray-800' if current_theme == 'dark' else 'bg-gray-300' }}"
    >
      <!-- Sidebar -->
      {% include 'sidebar.html' %}

      <!-- Main content -->
      <div class="flex flex-col flex-1 overflow-hidden h-full">
        <!-- Top Navbar -->
        {% include 'header.html' %}

        <!-- Page Content -->
        <main
          class="flex-1 overflow-y-auto pt-28 h-full transition-all duration-300"
          :class="Alpine.store('sidebar').open ? 'ml-[15%]' : 'ml-[5%]'"
        >
          <section
            class="flex items-center justify-center wow animate__animated animate__fadeInUp animate__delay-0.5s {{ 'bg-gray-800' if current_theme == 'dark' else 'bg-gray-300' }}"
          >
            <!-- Notification Box -->
            {% include 'notification_box.html' %}

            <!-- Content -->
            <div class="container mx-auto p-6">
              <!-- Notifikasi Biodata Belum Terdaftar -->
              {% if not biodata %}
              <div
                x-data="{ show: true }"
                x-show="show"
                x-transition:enter="transition ease-out duration-300"
                x-transition:enter-start="opacity-0 transform scale-95"
                x-transition:enter-end="opacity-100 transform scale-100"
                x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 transform scale-100"
                x-transition:leave-end="opacity-0 transform scale-95"
                class="mb-6 rounded-xl shadow-lg border-l-4 {{ 'bg-gray-900 border-yellow-500 text-white' if current_theme == 'dark' else 'bg-gray-100 border-yellow-400 text-black' }}"
              >
                <div class="p-4 flex items-start justify-between">
                  <div class="flex items-start gap-3 flex-1">
                    <i
                      class="fa-solid fa-triangle-exclamation text-2xl {{ 'text-yellow-400' if current_theme == 'dark' else 'text-yellow-600' }} mt-1"
                    ></i>
                    <div class="flex-1">
                      <h3
                        class="font-semibold text-lg mb-1 {{ 'text-white' if current_theme == 'dark' else 'text-gray-900' }}"
                      >
                        {{ 'Peringatan' if current_lang == 'id' else 'Warning'
                        }}
                      </h3>
                      <p
                        class="text-sm {{ 'text-gray-300' if current_theme == 'dark' else 'text-gray-700' }}"
                      >
                        {{ 'Biodata Anda belum terdaftar. Silakan hubungi
                        administrator untuk mendaftarkan biodata.' if
                        current_lang == 'id' else 'Your biodata is not
                        registered yet. Please contact the administrator to
                        register your biodata.' }}
                      </p>
                    </div>
                  </div>
                  <button
                    @click="show = false"
                    class="ml-4 {{ 'text-gray-400 hover:text-gray-200' if current_theme == 'dark' else 'text-gray-600 hover:text-gray-800' }} transition-colors cursor-pointer"
                    aria-label="Tutup notifikasi"
                  >
                    <i class="fa-solid fa-xmark text-lg"></i>
                  </button>
                </div>
              </div>
              {% endif %}

              <h1
                class="text-3xl font-bold mb-6 {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
              >
                {{ 'Dashboard Peserta' if current_lang == 'id' else 'Participant
                Dashboard' }}
              </h1>

              <!-- Status Cards -->
              <div
                class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-6"
              >
                <!-- Status Seleksi -->
                <div
                  class="rounded-xl shadow p-6 {{ 'bg-gray-900 text-white' if current_theme == 'dark' else 'bg-gray-100 text-black' }}"
                >
                  <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold">
                      {{ 'Status Seleksi' if current_lang == 'id' else
                      'Selection Status' }}
                    </h2>
                    <i
                      class="fa-solid fa-clipboard-check text-2xl text-blue-500"
                    ></i>
                  </div>
                  <p class="text-2xl font-bold text-blue-600">
                    {{ status_seleksi }}
                  </p>
                </div>

                <!-- Nilai Akhir -->
                {% if nilai_akhir is not none %}
                <div
                  class="rounded-xl shadow p-6 {{ 'bg-gray-900 text-white' if current_theme == 'dark' else 'bg-gray-100 text-black' }}"
                >
                  <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold">
                      {{ 'Nilai Akhir' if current_lang == 'id' else 'Final
                      Score' }}
                    </h2>
                    <i class="fa-solid fa-star text-2xl text-yellow-500"></i>
                  </div>
                  <p class="text-2xl font-bold text-yellow-600">
                    {{ "%.2f"|format(nilai_akhir) }}
                  </p>
                </div>

                <!-- Ranking -->
                {% if ranking is not none %}
                <div
                  class="rounded-xl shadow p-6 {{ 'bg-gray-900 text-white' if current_theme == 'dark' else 'bg-gray-100 text-black' }}"
                >
                  <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold">
                      {{ 'Ranking' if current_lang == 'id' else 'Ranking' }}
                    </h2>
                    <i class="fa-solid fa-trophy text-2xl text-green-500"></i>
                  </div>
                  <p class="text-2xl font-bold text-green-600">
                    #{{ ranking }}
                  </p>
                </div>
                {% endif %} 
                {% endif %}

                <!-- Jadwal Seleksi -->
                {% if biodata and biodata.kegiatan %}
                <div
                  class="rounded-xl shadow p-6 {{ 'bg-gray-900 text-white' if current_theme == 'dark' else 'bg-gray-100 text-black' }}"
                >
                  <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold">
                      {{ 'Jadwal Tes Seleksi' if current_lang == 'id' else 'Selection Test Schedule' }}
                    </h2>
                    <i class="fa-solid fa-calendar-day text-2xl text-purple-500"></i>
                  </div>
                  {% if biodata.kegiatan.tanggal_tes %}
                  <p class="text-lg font-bold text-purple-600">
                    {{ biodata.kegiatan.tanggal_tes.strftime('%d %b %Y') }}
                  </p>
                  <p class="text-sm opacity-70">
                    {{ biodata.kegiatan.tempat_tes or '-' }}
                  </p>
                  {% else %}
                  <p class="text-sm italic opacity-70">
                    {{ 'Jadwal tes belum ditentukan.' if current_lang == 'id' else 'Test schedule not yet determined.' }}
                  </p>
                  {% endif %}
                </div>
                {% endif %}
              </div>

              <!-- Biodata Section -->
              {% if biodata %}
              <div class="mt-8" id="biodata">
                <h2
                  class="text-2xl font-bold mb-4 {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                >
                  <i class="fa-solid fa-user-circle mr-2"></i>
                  {{ 'Biodata Peserta' if current_lang == 'id' else 'Participant
                  Biodata' }}
                </h2>
                <div
                  class="rounded-xl shadow p-6 {{ 'bg-gray-900 text-white' if current_theme == 'dark' else 'bg-white text-black' }}"
                >
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label
                        class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        {{ 'Nama Lengkap' if current_lang == 'id' else 'Full
                        Name' }}
                      </label>
                      <p
                        class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                      >
                        {{ biodata.nama_lengkap or '-' }}
                      </p>
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        {{ 'Tanggal Lahir' if current_lang == 'id' else 'Date of
                        Birth' }}
                      </label>
                      <p
                        class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                      >
                        {{ biodata.tanggal_lahir.strftime('%d/%m/%Y') if
                        biodata.tanggal_lahir else '-' }}
                      </p>
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        {{ 'Jenis Kelamin' if current_lang == 'id' else 'Gender'
                        }}
                      </label>
                      <p
                        class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                      >
                        {{ biodata.jenis_kelamin or '-' }}
                      </p>
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        {{ 'Usia' if current_lang == 'id' else 'Age' }}
                      </label>
                      <p
                        class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                      >
                        {{ biodata.usia or '-' }} {{ 'tahun' if current_lang ==
                        'id' else 'years' }}
                      </p>
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        {{ 'Golongan' if current_lang == 'id' else 'Group' }}
                      </label>
                      <p
                        class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                      >
                        {{ biodata.golongan or '-' }}
                      </p>
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        {{ 'Tingkatan' if current_lang == 'id' else 'Level' }}
                      </label>
                      <p
                        class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                      >
                        {{ biodata.tingkatan or '-' }}
                      </p>
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        {{ 'Email' if current_lang == 'id' else 'Email' }}
                      </label>
                      <p
                        class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                      >
                        {{ biodata.email or '-' }}
                      </p>
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        {{ 'Nomor HP' if current_lang == 'id' else 'Phone
                        Number' }}
                      </label>
                      <p
                        class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                      >
                        {{ biodata.nomor_hp or '-' }}
                      </p>
                    </div>
                    <div class="md:col-span-2">
                      <label
                        class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        {{ 'Alamat Tinggal' if current_lang == 'id' else
                        'Address' }}
                      </label>
                      <p
                        class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                      >
                        {{ biodata.alamat_tinggal or '-' }}
                      </p>
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        {{ 'Asal Gudep' if current_lang == 'id' else 'Gudep
                        Origin' }}
                      </label>
                      <p
                        class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                      >
                        {{ biodata.asal_gudep or '-' }}
                      </p>
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        {{ 'Asal Kwarran' if current_lang == 'id' else 'Kwarran
                        Origin' }}
                      </label>
                      <p
                        class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                      >
                        {{ biodata.asal_kwarran or '-' }}
                      </p>
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        {{ 'Asal Kwarcab' if current_lang == 'id' else 'Kwarcab
                        Origin' }}
                      </label>
                      <p
                        class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                      >
                        {{ biodata.asal_kwarcab or '-' }}
                      </p>
                    </div>
                    <div>
                      <label
                        class="text-sm font-medium {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        {{ 'Asal Kwarda' if current_lang == 'id' else 'Kwarda
                        Origin' }}
                      </label>
                      <p
                        class="font-semibold {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                      >
                        {{ biodata.asal_kwarda or '-' }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              {% endif %}

              <!-- Kegiatan Tersedia Section -->
              <div
                class="mt-8"
                id="kegiatan-tersedia"
                x-data="kegiatanTersedia()"
              >
                <h2
                  class="text-2xl font-bold mb-4 {{ 'text-white' if current_theme == 'dark' else 'text-black' }}"
                >
                  <i class="fa-solid fa-calendar-check mr-2"></i>
                  {{ 'Kegiatan Seleksi Tersedia' if current_lang == 'id' else
                  'Available Selection Activities' }}
                </h2>

                <!-- Loading State -->
                <div x-show="loading" class="text-center py-8">
                  <i
                    class="fa-solid fa-spinner fa-spin text-3xl text-blue-500"
                  ></i>
                  <p
                    class="mt-2 {{ 'text-gray-300' if current_theme == 'dark' else 'text-gray-600' }}"
                  >
                    {{ 'Memuat data...' if current_lang == 'id' else 'Loading
                    data...' }}
                  </p>
                </div>

                <!-- Empty State -->
                <div
                  x-show="!loading && kegiatanList.length === 0"
                  class="rounded-xl shadow p-6 text-center {{ 'bg-gray-900 text-white' if current_theme == 'dark' else 'bg-white text-black' }}"
                >
                  <i
                    class="fa-solid fa-calendar-xmark text-4xl text-gray-400 mb-4"
                  ></i>
                  <p
                    class="text-lg {{ 'text-gray-300' if current_theme == 'dark' else 'text-gray-600' }}"
                  >
                    {{ 'Tidak ada kegiatan seleksi yang sedang dibuka saat ini.'
                    if current_lang == 'id' else 'No selection activities are
                    currently open.' }}
                  </p>
                </div>

                <!-- Kegiatan List -->
                <div
                  x-show="!loading && kegiatanList.length > 0"
                  class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
                >
                  <template
                    x-for="kegiatan in kegiatanList"
                    :key="kegiatan.id_kegiatan"
                  >
                    <div
                      class="rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-xl {{ 'bg-gray-900 text-white border border-gray-700' if current_theme == 'dark' else 'bg-white text-black border border-gray-200' }}"
                    >
                      <!-- Header -->
                      <div class="mb-4">
                        <h3
                          class="text-xl font-bold mb-2"
                          x-text="kegiatan.nama_kegiatan"
                        ></h3>
                        <div class="flex items-center gap-2 mb-2">
                          <span
                            class="px-3 py-1 rounded-full text-xs font-semibold"
                            :class="kegiatan.sudah_terdaftar ? 'bg-green-500 text-white' : 'bg-blue-500 text-white'"
                            x-text="kegiatan.status"
                          ></span>
                          <span
                            class="px-3 py-1 rounded-full text-xs font-semibold {{ 'bg-gray-700 text-white' if current_theme == 'dark' else 'bg-gray-200 text-gray-800' }}"
                            x-text="kegiatan.jenis_kegiatan"
                          ></span>
                        </div>
                      </div>

                      <!-- Info Kegiatan -->
                      <div
                        class="space-y-2 mb-4 {{ 'text-gray-300' if current_theme == 'dark' else 'text-gray-600' }}"
                      >
                        <div class="flex items-start">
                          <i
                            class="fa-solid fa-map-marker-alt mr-2 mt-1 text-blue-500"
                          ></i>
                          <span
                            class="text-sm"
                            x-text="kegiatan.tempat_pelaksanaan"
                          ></span>
                        </div>
                        <div class="flex items-start">
                          <i
                            class="fa-solid fa-building mr-2 mt-1 text-blue-500"
                          ></i>
                          <span
                            class="text-sm"
                            x-text="kegiatan.kwartir_penyelenggara"
                          ></span>
                        </div>
                        <div class="flex items-start">
                          <i
                            class="fa-solid fa-globe mr-2 mt-1 text-blue-500"
                          ></i>
                          <span
                            class="text-sm"
                            x-text="kegiatan.skala_kegiatan"
                          ></span>
                        </div>
                        <div class="flex items-start">
                          <i
                            class="fa-solid fa-calendar-alt mr-2 mt-1 text-blue-500"
                          ></i>
                          <span class="text-sm">
                            <span
                              x-text="formatDate(kegiatan.waktu_pelaksanaan_dimulai)"
                            ></span>
                            <span
                              x-show="kegiatan.waktu_pelaksanaan_dimulai !== kegiatan.waktu_pelaksanaan_selesai"
                            >
                              -
                              <span
                                x-text="formatDate(kegiatan.waktu_pelaksanaan_selesai)"
                              ></span>
                            </span>
                          </span>
                        </div>
                        <div class="flex items-start">
                          <i
                            class="fa-solid fa-clock mr-2 mt-1 text-orange-500"
                          ></i>
                          <span class="text-sm">
                            {{ 'Periode Seleksi:' if current_lang == 'id' else
                            'Selection Period:' }}
                            <span
                              x-text="formatDate(kegiatan.periode_seleksi_mulai)"
                            ></span>
                            -
                            <span
                              x-text="formatDate(kegiatan.periode_seleksi_selesai)"
                            ></span>
                          </span>
                        </div>
                      </div>

                      <!-- Kuota Info -->
                      <div
                        class="mb-4 p-3 rounded-lg {{ 'bg-gray-800' if current_theme == 'dark' else 'bg-gray-100' }}"
                      >
                        <div class="grid grid-cols-2 gap-2 text-sm">
                          <div>
                            <span class="font-semibold"
                              >{{ 'Putra:' if current_lang == 'id' else 'Male:'
                              }}</span
                            >
                            <span
                              x-text="kegiatan.peserta_putra_terdaftar"
                            ></span
                            >/<span x-text="kegiatan.kuota_putra"></span>
                            <span
                              class="text-xs"
                              x-text="'(' + kegiatan.sisa_kuota_putra + ' tersisa)'"
                            ></span>
                          </div>
                          <div>
                            <span class="font-semibold"
                              >{{ 'Putri:' if current_lang == 'id' else
                              'Female:' }}</span
                            >
                            <span
                              x-text="kegiatan.peserta_putri_terdaftar"
                            ></span
                            >/<span x-text="kegiatan.kuota_putri"></span>
                            <span
                              class="text-xs"
                              x-text="'(' + kegiatan.sisa_kuota_putri + ' tersisa)'"
                            ></span>
                          </div>
                        </div>
                      </div>

                      <!-- Action Button -->
                      <!-- Tombol Batal Daftar (jika sudah terdaftar) -->
                      <button
                        x-show="kegiatan.sudah_terdaftar"
                        @click="openCancelModal(kegiatan.id_kegiatan, kegiatan.nama_kegiatan)"
                        :disabled="isCanceling"
                        :class="{
                          'bg-red-500 hover:bg-red-600': !isCanceling,
                          'bg-gray-400 cursor-not-allowed': isCanceling,
                          'opacity-50': isCanceling
                        }"
                        class="w-full py-2 px-4 rounded-lg text-white font-semibold transition-all duration-300 disabled:cursor-not-allowed"
                      >
                        <span x-show="!isCanceling">
                          <i class="fa-solid fa-times mr-2"></i>
                          {{ 'Batal Daftar' if current_lang == 'id' else 'Cancel
                          Registration' }}
                        </span>
                        <span x-show="isCanceling">
                          <i class="fa-solid fa-spinner fa-spin mr-2"></i>
                          {{ 'Membatalkan...' if current_lang == 'id' else
                          'Canceling...' }}
                        </span>
                      </button>

                      <!-- Tombol Daftar (jika belum terdaftar) -->
                      <button
                        x-show="!kegiatan.sudah_terdaftar"
                        @click="openRegisterModal(kegiatan.id_kegiatan, kegiatan.nama_kegiatan)"
                        :disabled="isRegistering"
                        :class="{
                          'bg-blue-500 hover:bg-blue-600': !isRegistering,
                          'bg-gray-400 cursor-not-allowed': isRegistering,
                          'opacity-50': isRegistering
                        }"
                        class="w-full py-2 px-4 rounded-lg text-white font-semibold transition-all duration-300 disabled:cursor-not-allowed"
                      >
                        <span x-show="!isRegistering">
                          <i class="fa-solid fa-user-plus mr-2"></i>
                          {{ 'Daftar Seleksi' if current_lang == 'id' else
                          'Register for Selection' }}
                        </span>
                        <span x-show="isRegistering">
                          <i class="fa-solid fa-spinner fa-spin mr-2"></i>
                          {{ 'Mendaftar...' if current_lang == 'id' else
                          'Registering...' }}
                        </span>
                      </button>
                    </div>
                  </template>
                </div>

                <!-- Modal Konfirmasi Daftar Seleksi -->
                <div
                  x-show="showRegisterModal"
                  x-transition
                  class="fixed inset-0 z-50 flex items-center justify-center {{ 'bg-black/50' if current_theme == 'dark' else 'bg-gray-400/50' }} backdrop-blur-sm"
                  @click.away="closeRegisterModal()"
                  x-cloak
                >
                  <div
                    @click.stop
                    class="w-full max-w-md rounded-2xl shadow-2xl {{ 'bg-gray-800 text-white' if current_theme == 'dark' else 'bg-white text-gray-900' }} p-6 m-4"
                  >
                    <div class="flex items-center justify-between mb-4">
                      <h3 class="text-xl font-bold">
                        {{ 'Konfirmasi Daftar Seleksi' if current_lang == 'id' else 'Confirm Registration' }}
                      </h3>
                      <button
                        @click="closeRegisterModal()"
                        class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition cursor-pointer"
                        aria-label="Close"
                      >
                        <i class="fa-solid fa-times text-lg"></i>
                      </button>
                    </div>
                    
                    <div class="mb-6">
                      <div class="flex items-center justify-center mb-4">
                        <div class="text-4xl text-blue-500 animate-pulse">
                          <i class="fa-solid fa-user-plus"></i>
                        </div>
                      </div>
                      <p class="text-center {{ 'text-gray-300' if current_theme == 'dark' else 'text-gray-600' }}">
                        {{ 'Apakah Anda yakin ingin mendaftar ke seleksi kegiatan' if current_lang == 'id' else 'Are you sure you want to register for selection activity' }}?
                      </p>
                      <p class="text-center mt-2 font-semibold" x-text="selectedKegiatanRegister ? selectedKegiatanRegister.nama : ''"></p>
                      <p class="text-sm text-center mt-3 {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-500' }}">
                        {{ 'Setelah mendaftar, Anda akan mengikuti proses seleksi untuk kegiatan ini.' if current_lang == 'id' else 'After registering, you will participate in the selection process for this activity.' }}
                      </p>
                    </div>
                    
                    <div class="flex justify-end gap-4">
                      <button
                        @click="closeRegisterModal()"
                        class="px-6 py-2.5 rounded-lg font-medium cursor-pointer {{ 'bg-gray-600 hover:bg-gray-700 text-white' if current_theme == 'dark' else 'bg-gray-200 hover:bg-gray-300 text-gray-900' }} transition"
                      >
                        {{ 'Batal' if current_lang == 'id' else 'Cancel' }}
                      </button>
                      <button
                        @click="daftarSeleksi()"
                        :disabled="isRegistering"
                        class="px-6 py-2.5 rounded-lg font-semibold cursor-pointer text-white bg-blue-600 hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
                      >
                        <span x-show="!isRegistering">
                          {{ 'Ya, Daftar' if current_lang == 'id' else 'Yes, Register' }}
                        </span>
                        <span x-show="isRegistering">
                          <i class="fa-solid fa-spinner fa-spin mr-2"></i>
                          {{ 'Mendaftar...' if current_lang == 'id' else 'Registering...' }}
                        </span>
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Modal Konfirmasi Batal Daftar -->
                <div
                  x-show="showCancelModal"
                  x-transition
                  class="fixed inset-0 z-50 flex items-center justify-center {{ 'bg-black/50' if current_theme == 'dark' else 'bg-gray-400/50' }} backdrop-blur-sm"
                  @click.away="closeCancelModal()"
                  x-cloak
                >
                  <div
                    @click.stop
                    class="w-full max-w-md rounded-2xl shadow-2xl {{ 'bg-gray-800 text-white' if current_theme == 'dark' else 'bg-white text-gray-900' }} p-6 m-4"
                  >
                    <div class="flex items-center justify-between mb-4">
                      <h3 class="text-xl font-bold">
                        {{ 'Konfirmasi Batal Daftar' if current_lang == 'id' else 'Confirm Cancel Registration' }}
                      </h3>
                      <button
                        @click="closeCancelModal()"
                        class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition cursor-pointer"
                        aria-label="Close"
                      >
                        <i class="fa-solid fa-times text-lg"></i>
                      </button>
                    </div>
                    
                    <div class="mb-6">
                      <div class="flex items-center justify-center mb-4">
                        <div class="text-4xl text-orange-500 animate-pulse">
                          <i class="fa-solid fa-triangle-exclamation"></i>
                        </div>
                      </div>
                      <p class="text-center {{ 'text-gray-300' if current_theme == 'dark' else 'text-gray-600' }}">
                        {{ 'Apakah Anda yakin ingin membatalkan pendaftaran ke seleksi kegiatan' if current_lang == 'id' else 'Are you sure you want to cancel registration for selection activity' }}?
                      </p>
                      <p class="text-center mt-2 font-semibold" x-text="selectedKegiatan ? selectedKegiatan.nama : ''"></p>
                      <p class="text-sm text-center mt-3 {{ 'text-gray-400' if current_theme == 'dark' else 'text-gray-500' }}">
                        {{ 'Tindakan ini akan menghapus pendaftaran Anda dari kegiatan ini.' if current_lang == 'id' else 'This action will remove your registration from this activity.' }}
                      </p>
                    </div>
                    
                    <div class="flex justify-end gap-4">
                      <button
                        @click="closeCancelModal()"
                        class="px-6 py-2.5 rounded-lg font-medium cursor-pointer {{ 'bg-gray-600 hover:bg-gray-700 text-white' if current_theme == 'dark' else 'bg-gray-200 hover:bg-gray-300 text-gray-900' }} transition"
                      >
                        {{ 'Batal' if current_lang == 'id' else 'Cancel' }}
                      </button>
                      <button
                        @click="batalDaftarSeleksi()"
                        :disabled="isCanceling"
                        class="px-6 py-2.5 rounded-lg font-semibold cursor-pointer text-white bg-red-600 hover:bg-red-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
                      >
                        <span x-show="!isCanceling">
                          {{ 'Ya, Batalkan' if current_lang == 'id' else 'Yes, Cancel' }}
                        </span>
                        <span x-show="isCanceling">
                          <i class="fa-solid fa-spinner fa-spin mr-2"></i>
                          {{ 'Membatalkan...' if current_lang == 'id' else 'Canceling...' }}
                        </span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

    <!-- Script untuk Kegiatan Tersedia -->
    <script>
      document.addEventListener("alpine:init", () => {
        Alpine.data("kegiatanTersedia", () => ({
          kegiatanList: [],
          loading: true,
          isRegistering: false,
          isCanceling: false,
          showCancelModal: false,
          showRegisterModal: false,
          selectedKegiatan: null,
          selectedKegiatanRegister: null,

          async init() {
            await this.loadKegiatan();
          },

          async loadKegiatan() {
            try {
              this.loading = true;
              const response = await fetch("/api/kegiatan_tersedia");
              const result = await response.json();

              if (result.status === "success") {
                this.kegiatanList = result.data;
              } else {
                console.error("Error loading kegiatan:", result.message);
                // Tampilkan notifikasi error jika ada
                if (window.showNotification) {
                  window.showNotification(
                    "error",
                    '{{ "Error" if current_lang == "id" else "Error" }}',
                    result.message ||
                      '{{ "Gagal memuat data kegiatan" if current_lang == "id" else "Failed to load activity data" }}'
                  );
                }
              }
            } catch (error) {
              console.error("Error:", error);
              if (window.showNotification) {
                window.showNotification(
                  "error",
                  '{{ "Error" if current_lang == "id" else "Error" }}',
                  '{{ "Terjadi kesalahan saat memuat data" if current_lang == "id" else "An error occurred while loading data" }}'
                );
              }
            } finally {
              this.loading = false;
            }
          },

          formatDate(dateString) {
            if (!dateString) return "-";
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, "0");
            const month = String(date.getMonth() + 1).padStart(2, "0");
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
          },

          openRegisterModal(kegiatanId, namaKegiatan) {
            this.selectedKegiatanRegister = { id: kegiatanId, nama: namaKegiatan };
            this.showRegisterModal = true;
          },

          closeRegisterModal() {
            this.showRegisterModal = false;
            this.selectedKegiatanRegister = null;
          },

          async daftarSeleksi() {
            if (this.isRegistering || !this.selectedKegiatanRegister) return;

            try {
              this.isRegistering = true;
              this.showRegisterModal = false;

              const response = await fetch("/api/daftar_seleksi", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ kegiatan_id: this.selectedKegiatanRegister.id }),
              });

              const result = await response.json();

              if (result.status === "success") {
                // Tampilkan notifikasi sukses
                if (window.showNotification) {
                  window.showNotification(
                    "success",
                    '{{ "Success" if current_lang == "id" else "Success" }}',
                    result.message ||
                      '{{ "Berhasil mendaftar" if current_lang == "id" else "Successfully registered" }}!'
                  );
                }

                // Reload data kegiatan untuk update status
                await this.loadKegiatan();

                // Reload halaman setelah 1 detik untuk update status seleksi
                setTimeout(() => {
                  window.location.reload();
                }, 1000);
              } else {
                // Tampilkan notifikasi error
                if (window.showNotification) {
                  window.showNotification(
                    "error",
                    '{{ "Error" if current_lang == "id" else "Error" }}',
                    result.message ||
                      '{{ "Gagal mendaftar" if current_lang == "id" else "Failed to register" }}'
                  );
                }
              }
            } catch (error) {
              console.error("Error:", error);
              if (window.showNotification) {
                window.showNotification(
                  "error",
                  '{{ "Error" if current_lang == "id" else "Error" }}',
                  '{{ "Terjadi kesalahan saat mendaftar" if current_lang == "id" else "An error occurred while registering" }}'
                );
              }
            } finally {
              this.isRegistering = false;
              this.selectedKegiatanRegister = null;
            }
          },

          openCancelModal(kegiatanId, namaKegiatan) {
            this.selectedKegiatan = { id: kegiatanId, nama: namaKegiatan };
            this.showCancelModal = true;
          },

          closeCancelModal() {
            this.showCancelModal = false;
            this.selectedKegiatan = null;
          },

          async batalDaftarSeleksi() {
            if (this.isCanceling || !this.selectedKegiatan) return;

            try {
              this.isCanceling = true;
              this.showCancelModal = false;

              const response = await fetch("/api/batal_daftar_seleksi", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ kegiatan_id: this.selectedKegiatan.id }),
              });

              const result = await response.json();

              if (result.status === "success") {
                // Tampilkan notifikasi sukses
                if (window.showNotification) {
                  window.showNotification(
                    "success",
                    '{{ "Success" if current_lang == "id" else "Success" }}',
                    result.message ||
                      '{{ "Berhasil membatalkan pendaftaran" if current_lang == "id" else "Successfully canceled registration" }}!'
                  );
                }

                // Reload data kegiatan untuk update status
                await this.loadKegiatan();

                // Reload halaman setelah 1 detik untuk update status seleksi
                setTimeout(() => {
                  window.location.reload();
                }, 1000);
              } else {
                // Tampilkan notifikasi error
                if (window.showNotification) {
                  window.showNotification(
                    "error",
                    '{{ "Error" if current_lang == "id" else "Error" }}',
                    result.message ||
                      '{{ "Gagal membatalkan pendaftaran" if current_lang == "id" else "Failed to cancel registration" }}'
                  );
                }
              }
            } catch (error) {
              console.error("Error:", error);
              if (window.showNotification) {
                window.showNotification(
                  "error",
                  '{{ "Error" if current_lang == "id" else "Error" }}',
                  '{{ "Terjadi kesalahan saat membatalkan pendaftaran" if current_lang == "id" else "An error occurred while canceling registration" }}'
                );
              }
            } finally {
              this.isCanceling = false;
              this.selectedKegiatan = null;
            }
          },
        }));
      });
    </script>

    <!-- Notifikasi Toast -->
    <div
      x-data="{ notifications: [] }"
      x-init="window.showNotification = function(category, title, message) {
        const notification = { id: Date.now(), category, title, message, show: true };
        $data.notifications.push(notification);
        setTimeout(() => {
          notification.show = false;
          setTimeout(() => {
            $data.notifications = $data.notifications.filter(n => n.id !== notification.id);
          }, 300);
        }, 5000);
      }"
      class="fixed bottom-6 right-6 z-[60] space-y-3"
    >
      <template x-for="notification in notifications" :key="notification.id">
        <div
          x-show="notification.show"
          x-transition:enter="transition ease-out duration-300"
          x-transition:enter-start="opacity-0 transform translate-x-full"
          x-transition:enter-end="opacity-100 transform translate-x-0"
          x-transition:leave="transition ease-in duration-200"
          x-transition:leave-start="opacity-100 transform translate-x-0"
          x-transition:leave-end="opacity-0 transform translate-x-full"
          class="flex items-center gap-3 px-6 py-4 rounded-2xl shadow-xl border min-w-[300px] max-w-md"
          :class="{
            'bg-green-600 text-white border-green-500': notification.category === 'success',
            'bg-red-600 text-white border-red-500': notification.category === 'danger' || notification.category === 'error',
            'bg-yellow-500 text-gray-900 border-yellow-400': notification.category === 'warning',
            'bg-gray-800 text-white border-gray-700': !['success', 'danger', 'error', 'warning'].includes(notification.category)
          }"
        >
          <i
            class="fa-solid text-lg"
            :class="{
              'fa-circle-check': notification.category === 'success',
              'fa-triangle-exclamation': notification.category === 'danger' || notification.category === 'error',
              'fa-exclamation-circle': notification.category === 'warning',
              'fa-info-circle': !['success', 'danger', 'error', 'warning'].includes(notification.category)
            }"
          ></i>
          <div class="flex-1">
            <strong x-text="notification.title"></strong><br />
            <span class="text-sm" x-text="notification.message"></span>
          </div>
          <button
            @click="notification.show = false; setTimeout(() => notifications = notifications.filter(n => n.id !== notification.id), 300)"
            class="ml-2 text-lg opacity-70 hover:opacity-100 transition-opacity"
          >
            <i class="fa-solid fa-times"></i>
          </button>
        </div>
      </template>
    </div>
  </body>
</html>
